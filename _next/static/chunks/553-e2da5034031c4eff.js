"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[553],{50553:function(e,a,t){t.d(a,{a:function(){return MigrationTip}});var n=t(31113),s=t(26504),r=t(19757),i=t(59175),l=t(15506),o=t(26361),c=t(84944),d=t(69708),u=t(64103),m=t(55746),x=t(90437),h=t(14993),p=t(58714),f=t(35004),b=t(41440),g=t(75496),N=t(33621),v=t(2987),j=t(36762),y=t(64370);function MarginLoan(e){let{symbol:a,value:t}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2 pr-8",children:[(0,n.jsx)(N.c,{symbol:a,size:20}),(0,n.jsx)("span",{children:(0,c.dq)(t)})]})}function bnGt(e){return e>=200000n?e:0n}function MigrationV2(){let e=(0,i.p)(),a=r.Lh[e][0],t=r.Lh[e][1],x=r.iK[e][0],N=r.iK[e][1],[k,T]=(0,h.Z)(!1),{address:w,chain:W}=(0,b.m)(),{data:S,isFetching:A}=function(e){let a=(0,i.p)(),{address:t}=(0,b.m)(),n=r.Lh[a][0],c=r.Lh[a][1],d=(0,l.lo)(),queryFn=async()=>{let e=await Promise.all([{abi:p.Wo,address:n.xTokenAddress,functionName:"balanceOf",args:[t]},{abi:p.Wo,address:c.xTokenAddress,functionName:"balanceOf",args:[t]},{abi:s.aT,address:n.ptyPoolAboveAddress,functionName:"userStakingBalance",args:[t]},{abi:s.aT,address:n.ptyPoolBelowAddress,functionName:"userStakingBalance",args:[t]},{abi:p.Wo,address:r.O1[a],functionName:"balanceOf",args:[t]},{abi:p.Wo,address:n.xTokenAddress,functionName:"totalSupply"},{abi:s.WW,address:n.vault,functionName:"usbTotalSupply"},{abi:s.aT,address:n.ptyPoolBelowAddress,functionName:"earnedStakingYields",args:[t]}].map(e=>d(e))),i=(0,o.ok)(e,[7]),l=(0,o.ok)(e,[0]),u=l+i,m=(0,o.ok)(e,[1]),x=(0,o.Rj)(e,[2]),h=(0,o.Rj)(e,[3]),f=(0,o.ok)(e,[4]),b=(0,o.ok)(e,[5]),g=(0,o.ok)(e,[6]),N=await Promise.all([bnGt(l)?d({abi:s.Wn,address:r.O6[a],functionName:"calcPairedRedeemAssetAmount",args:[n.vault,l]}).then(e=>e[1]):0n,bnGt(m)?d({abi:s.Wn,address:r.O6[a],functionName:"calcRedeemByMarginTokensFromStableVault",args:[c.vault,r.e_[a],m]}).then(e=>e[2]):0n]),v=l?(0,o.ok)(N,[0]):0n,j=m?(0,o.ok)(N,[1]):0n;return{earnEthx:i,ethxBalance:l,ethxTotal:u,usdbxBalance:m,ethStaked:x,usbStaked:h,usbBalance:f,usbTotal:f+h,ethxMarginloan:b>0n?-(u*g)/b:0n,ethOutAmount:v,usdbOutAmount:j}};return(0,y.a)({queryFn,queryKey:[a,t,e],refetchOnMount:!1,refetchOnWindowFocus:!1,initialData:(0,o.Yb)({},0n)})}(k),M=S.usbTotal+S.ethxMarginloan<10000n&&bnGt(S.ethxTotal)>0n,B=S.ethxTotal+S.usdbxBalance+S.ethStaked<=0n,{mutateAsync:O,isPending:V,finishCount:P,reset:E}=(0,l.Lh)(),F=Object.values(S).toString(),G=(0,u.useMemo)(()=>{let e=[];return bnGt(S.usbStaked)?e.push({name:"Withdraw ".concat(r.TW," from V1 Earn Pool"),abi:s.aT,address:a.ptyPoolBelowAddress,functionName:"exit"}):bnGt(S.earnEthx)&&e.push({name:"Withdraw ".concat(r.TW," from V1 Earn Pool"),abi:s.aT,address:a.ptyPoolBelowAddress,functionName:"claimAll"}),bnGt(S.ethStaked)&&e.push({name:"Withdraw ETH from V1 Earn Pool",abi:s.aT,address:a.ptyPoolAboveAddress,functionName:"exit"}),bnGt(S.ethxTotal)&&e.push({name:"Redeem ETH from V1 Vault",abi:s.WW,address:a.vault,functionName:"redeemByPairsWithExpectedMarginTokenAmount",args:[S.ethxTotal]}),bnGt(S.ethOutAmount)&&e.push({name:"Deposit ETH to V2 Vault",abi:s.WW,address:x.vault,functionName:"mintPairs",args:[S.ethOutAmount],value:S.ethOutAmount}),bnGt(S.usdbxBalance)&&e.push({name:"Redeem USDB from V1 Vault",abi:s.S4,address:t.vault,functionName:"redeemByMarginTokens",args:[S.usdbxBalance]}),bnGt(S.usdbOutAmount)&&w&&e.push({name:"Deposit USDB to V2 Vault",abi:s.S4,address:N.vault,functionName:"mintMarginTokens",args:[S.usdbOutAmount],prepare:async(e,a,t)=>{let n=await a.readContract({abi:p.Wo,address:N.assetTokenAddress,functionName:"balanceOf",args:[w]}),s=n<S.usdbOutAmount?n:S.usdbOutAmount,r=await a.readContract({abi:p.Wo,address:N.assetTokenAddress,functionName:"allowance",args:[w,N.vault]});if(r<s){let e=await t.writeContract({chain:W,account:w,abi:p.Wo,address:N.assetTokenAddress,functionName:"approve",args:[N.vault,(0,f.f)("100000000000")]});await a.waitForTransactionReceipt({hash:e,confirmations:5})}return{...e,args:[s]}}}),e},[F,a,x,t,N,null==W?void 0:W.id,w]);(0,u.useEffect)(()=>{E()},[F]);let C=P==G.length,R=(0,u.useRef)(null),migrate=async()=>{try{var e;if(C)return null===(e=R.current)||void 0===e?void 0:e.click();if(B)return;console.info("tasks:",G),await O(G)}catch(e){(0,o.S3)(e)}},D=(0,d.useRouter)(),L=(0,d.usePathname)();return(0,n.jsx)(v.o,{disableOutClose:!0,style:{},open:k,onOpenChange:T,className:"backdrop-blur-lg max-w-[800px]",disableClose:V,triggerProps:{className:"shrink-0"},trigger:(0,n.jsx)("button",{className:"btn-primary mt-0",children:"MIGRATION TO V2"}),children:(0,n.jsxs)("div",{className:"card flex flex-col gap-4 !bg-transparent",children:[(0,n.jsx)("div",{className:"page-sub text-left",children:"MIGRATION TO V2"}),(0,n.jsxs)("div",{children:["Before migration, make sure your ",r.TW," balance is greater than your margin loan."]}),A?(0,n.jsx)("div",{className:"flex justify-center items-center h-[357px]",children:(0,n.jsx)(j.$,{})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[(0,n.jsx)("div",{className:"rounded-lg overflow-x-auto w-full bg-zinc-200 dark:bg-slate-950 pb-2",children:(0,n.jsx)(g.ZP,{header:["","Balance","Margin loan"],data:[["ETHx-V1",(0,c.dq)(bnGt(S.ethxTotal)),(0,n.jsx)(MarginLoan,{symbol:r.TW,value:S.ethxMarginloan},"ethx_ml")],["USDBx-V1",(0,c.dq)(bnGt(S.usdbxBalance)),""],["ETH-V1",(0,c.dq)(bnGt(S.ethStaked)),""],[r.TW,(0,c.dq)(S.usbTotal),""]]})}),(0,n.jsxs)("div",{className:"flex flex-col pl-3 pt-5 gap-1 md:pl-5 md:pt-2",children:[(0,n.jsx)("div",{className:"text-lg",children:"Progress"}),G.map((e,a)=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{children:["- ",e.name]}),a<P&&(0,n.jsx)(m.ZSR,{className:"text-green-500"}),V&&a==P&&(0,n.jsx)(j.$,{})]},"task_"+a))]})]}),(0,n.jsxs)("button",{className:"btn-primary flex items-center gap-2 justify-center",disabled:M||V||A,onClick:migrate,children:[V&&(0,n.jsx)(j.$,{}),C&&(0,n.jsx)(m.ZSR,{className:"text-green-500"}),V?"Migrating":P==G.length?"Completed":"Start to Migration"]}),M&&(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("span",{children:[r.TW," balance is insufficient. "]}),(0,n.jsxs)("span",{children:["Mint more ",r.TW," from the"]})," ",(0,n.jsx)("button",{className:"underline text-indigo-500 dark:text-violet-300 outline-none inline-block",onClick:()=>{var e;if("/vaults"==L)return null===(e=R.current)||void 0===e?void 0:e.click();D.push("/vaults")},children:"USDB V2 Vault"})]})]})]})})}function MigrationTip(){let e=(0,i.p)(),a=r.Lh[e],t=a&&a.length>0;return t?(0,n.jsxs)("div",{className:"flex flex-col justify-center gap-4 items-center md:flex-row",children:[(0,n.jsxs)("div",{className:"text-sm text-red-500 p-2 rounded bg-[#FFE5E0] flex items-center gap-2",children:[(0,n.jsx)("div",{className:"p-1 rounded bg-red-500",children:(0,n.jsx)(x._sk,{className:"text-white"})}),"Wand has been updated to Version2. Please ensure you complete the migration of your assets promptly."]}),(0,n.jsx)(MigrationV2,{})]}):null}},75496:function(e,a,t){var n=t(31113),s=t(26361);function DefEmpty(){return(0,n.jsx)("tr",{className:"text-lg font-normal text-center text-black ",children:(0,n.jsx)("td",{colSpan:100,className:"h-[100px] py-5 align-top"})})}t(64103),a.ZP=e=>{let{header:a,data:t,span:r={},empty:i=(0,n.jsx)(DefEmpty,{}),className:l="relative min-w-full bg-transparent ",headerClassName:o,headerItemClassName:c,tbodyClassName:d="",rowClassName:u,rowStyle:m,cellClassName:x,onClickRow:h,onRowMouseHover:p}=e;return(0,n.jsxs)("table",{className:(0,s.cn)("relative min-w-full bg-transparent ",l),children:[(0,n.jsx)("thead",{className:"",children:(0,n.jsx)("tr",{className:(0,s.cn)("text-left whitespace-nowrap font-normal text-black border-b border-gray-100 pt-5 pb-6 dark:text-slate-50 dark:border-zinc-600",o),children:a.map((e,a)=>(0,n.jsx)("th",{colSpan:r[a],scope:"col",className:(0,s.cn)(0==r[a]?"p-0 w-0":"p-3 font-normal text-sm",c),children:e},a))})}),(0,n.jsxs)("tbody",{className:(0,s.cn)(d),children:[t.map((e,t)=>(0,n.jsx)("tr",{onClick:()=>h&&h(t),onMouseEnter:()=>p&&p(t),onMouseLeave:()=>p&&p(-1),style:"function"==typeof m?m(t):m,className:(0,s.cn)("text-slate-700 dark:text-slate-50 font-medium whitespace-nowrap",h?"cursor-pointer hover:bg-slate-400/10":"","function"==typeof u?u(t):u),children:e.map((e,i)=>i>=a.length?(0,n.jsx)(n.Fragment,{children:e}):(0,n.jsx)("td",{colSpan:r[i],className:(0,s.cn)(0==r[i]?"p-0 w-max":"px-3 py-2 text-sm w-max","function"==typeof x?x(t,i):x),children:e},i))},t)),0===t.length&&i]})]})}},36762:function(e,a,t){t.d(a,{$:function(){return Spinner}});var n=t(31113),s=t(33501);let Spinner=e=>{let{className:a}=e;return(0,n.jsxs)("svg",{fill:"none",className:(0,s.Z)(a,"animate-spin h-5 w-5 2-ml-1 2mr-3"),viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}},84944:function(e,a,t){t.d(a,{Rp:function(){return displayBalanceWithUnit},ZM:function(){return displayBalanceWithoutFormat},dq:function(){return displayBalance}});var n=t(35057),s=t(11292);let displayBalanceWithUnit=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,t=arguments.length>2?arguments[2]:void 0;if(!e)return"0";let s=10**a,r=Math.floor(Number((0,n.b)(e,t))*s)/s,i=Number((.1**a).toFixed(a));return r>0&&r<i?"<"+i:r<0&&r>-i?"≈0":r.toLocaleString("en-US",{maximumFractionDigits:a})},displayBalance=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return"0";let n=Number((0,s.d)(e)),r=Number((.1**a).toFixed(a));return n>0&&n<r?"<"+r:n<0&&n>-r?"≈0":n.toLocaleString("en-US",{...t||{},maximumFractionDigits:a})},displayBalanceWithoutFormat=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return"0";let t=10**a,n=Math.floor(Number((0,s.d)(e))*t)/t,r=Number((.1**a).toFixed(a));return n>0&&n<r?"<"+r:n<0&&n>-r?"≈0":String(n)}}}]);