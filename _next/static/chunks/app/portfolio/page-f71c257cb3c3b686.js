(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5444],{14340:function(e,t,n){Promise.resolve().then(n.bind(n,94234))},94234:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Dashboard}});var a=n(31113),s=n(44939),l=n(75496),r=n(31889),o=n(93680),i=n(26537),u=n(95702),c=n(30639),d=n(4283),m=n(6371),p=n(19757),x=n(59175),h=n(26361),f=n(39577),S=n(36602),v=n(84944),y=n(3106),b=n(87031),g=n(22139),T=n(90168),j=n(18358),k=n(64103),w=n(83978),V=n.n(w),B=n(69708),L=n(55746);function PortfolioItem(e){let{title:t,sub:n,tHeader:s,tData:r,tableProps:o}=e;return(0,a.jsxs)("div",{className:"card whitespace-nowrap",children:["string"==typeof t?(0,a.jsx)("div",{className:"text-2xl leading-none font-semibold",children:t}):t,"string"==typeof n?(0,a.jsx)("div",{className:"text-[2rem] text-primary leading-none font-semibold mt-2",children:n}):n,(0,a.jsx)("div",{className:"my-4 h-[1px] bg-border/60 dark:bg-border"}),(0,a.jsx)("div",{className:"w-full overflow-x-auto",children:(0,a.jsx)(l.ZP,{headerClassName:"border-b-0",tbodyClassName:"text-sm font-medium",header:s,data:r,...o||{}})})]})}let U={BeraLine:o.Z,BullLine:i.Z,PandaLine:c.Z,VenomLine:d.Z};function IconTitle(e){let t=U[e.icon];return(0,a.jsxs)("div",{className:"flex text-2xl leading-none font-semibold items-center gap-4",children:[(0,a.jsx)(t,{className:"text-[2rem]",showBg:!0}),(0,a.jsx)("span",{children:e.tit})]})}function CoinText(e){return(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(u.c,{symbol:e.symbol,size:e.size||20}),(0,a.jsx)("span",{children:e.txt||e.symbol})]})}function InterestItem(){let{apr:e,aprDecimals:t}=(0,f.UM)(),n=(0,x.p)(),s=(0,S.l)(),l=s[p.O1[n]],r=l*e/365n/10n**BigInt(t);return(0,a.jsx)(PortfolioItem,{title:(0,a.jsx)(IconTitle,{tit:"Interest Bear",icon:"BeraLine"}),tHeader:["","Balance","APY","Est. Yield/day"],tData:[[(0,a.jsx)(CoinText,{symbol:p.TW},"icon"),(0,v.d)(l),(0,h.Jh)(e,t),(0,v.d)(r)]]})}function LeverageItem(){let e=(0,x.p)(),t=p.iK[e],n=(0,S.l)(),s=(0,k.useMemo)(()=>{let calcMyOpenPosition=e=>{let t=y.w.getState(),a=t.sliceLVaultsStore.lvaults[e.vault]||f.pK,s=a.isStable?a.M_USDC:a.M_ETH,l=a.isStable?a.M_USDCx:a.M_ETHx,r=l>0n?n[e.xTokenAddress]*s/l:0n;return r},calcMyMarginLoan=e=>{let t=y.w.getState(),a=t.sliceLVaultsStore.lvaults[e.vault]||f.pK,s=a.isStable?a.M_USDCx:a.M_ETHx,l=a.isStable?a.M_USB_USDC:a.M_USB_ETH,r=s>0n?-(n[e.xTokenAddress]*l)/s:0n;return r};return t.map(e=>[(0,a.jsx)(CoinText,{symbol:e.xTokenSymbol},"coin"),(0,v.d)(n[e.xTokenAddress]),(0,a.jsx)(CoinText,{symbol:e.assetTokenSymbol,txt:(0,v.d)(calcMyOpenPosition(e))},"openposit"),(0,a.jsx)(CoinText,{symbol:p.TW,txt:(0,v.d)(calcMyMarginLoan(e))},"marginloan")])},[n,t]);return(0,a.jsx)(PortfolioItem,{title:(0,a.jsx)(IconTitle,{tit:"Leverage Bull",icon:"BullLine"}),tHeader:["","Balance","Open Position",(0,a.jsxs)("div",{children:["Margin Loan",(0,a.jsx)(m.C,{children:"Repay your margin loan to redeem asset corresponding to your open position."})]},"marginloan")],tData:s})}function PrincipalItem(){let e=(0,B.useRouter)(),t=(0,x.p)(),n=(0,k.useMemo)(()=>b.Fw[t].filter(e=>(e.onEnv||[]).includes(g.Vi)),[t]),s=(0,k.useMemo)(()=>{let t=y.w.getState(),inRedeem=e=>(t.sliceUserBVaults.epoches[e.vault]||[]).reduce((e,t)=>e+t.redeemingBalance,0n),claimAble=e=>(t.sliceUserBVaults.epoches[e.vault]||[]).reduce((e,t)=>e+t.claimableAssetBalance,0n),yieldDay=e=>{let n=t.sliceTokenStore.balances[e.pToken]||0n;return(0,j.lL)(e.vault)*n/10n**10n/365n},s=n.map(e=>{var n,a,s;let l=t.sliceTokenStore.balances[e.pToken]||0n,r=inRedeem(e),o=claimAble(e),i=l+r+o,u=T.P[e.asset],[c,d]=u?e.assetSymbol.split("-"):["",""],m=(null===(n=t.sliceBVaultsStore.bvaults[e.vault])||void 0===n?void 0:n.lpLiq)||0n,p=(null===(a=t.sliceBVaultsStore.bvaults[e.vault])||void 0===a?void 0:a.lpBase)||0n,x=(null===(s=t.sliceBVaultsStore.bvaults[e.vault])||void 0===s?void 0:s.lpQuote)||0n,h=u&&m&&p&&i?i*p/m:0n,f=u&&m&&x&&i?i*x/m:0n,S=(0,v.d)(i);return{bvc:e,pBalance:l,pRedeeming:r,pClaimAble:o,lp:u,baseSymbol:c,quoteSymbol:d,uBase:h,uQuote:f,pTotalUser:i,fmtTotalUser:S}}).filter(e=>e.pTotalUser>0n),l=s.reduce((e,t)=>Math.max(e,t.fmtTotalUser.length),0),r=Math.round(5*l+20);return s.map(t=>{let{bvc:n,pBalance:s,pRedeeming:l,pClaimAble:o,lp:i,fmtTotalUser:u,baseSymbol:c,quoteSymbol:d,uBase:m,uQuote:p}=t;return[(0,a.jsx)(CoinText,{symbol:n.assetSymbol,txt:n.pTokenSymbol,size:32},"coin"),(0,v.d)(s),(0,v.d)(l),(0,a.jsxs)("div",{className:"flex w-fit cursor-pointer items-center gap-2 underline",onClick:()=>e.push("/b-vaults?vault=".concat(n.vault,"&tab=principal_panda&subtab=claim")),children:[(0,v.d)(o),(0,a.jsx)(L.HV3,{})]},"claim"),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{style:{width:r},children:u}),i&&(0,a.jsxs)("div",{children:[(0,a.jsx)(CoinText,{size:14,symbol:c,txt:(0,v.d)(m)}),(0,a.jsx)(CoinText,{size:14,symbol:d,txt:(0,v.d)(p)})]})]},"total"),(0,h.Jh)((0,j.lL)(n.vault),10),(0,v.d)(yieldDay(n))]})},[n,y.w.getState()]);return(0,a.jsx)(PortfolioItem,{title:(0,a.jsx)(IconTitle,{tit:"Principal Panda",icon:"PandaLine"}),tHeader:["","Balance","In Redemption","Claimable","Total Amount","APY","Est.Yield/day"],tData:s})}function BoostItem(){let e=(0,B.useRouter)(),t=(0,x.p)(),n=(0,k.useMemo)(()=>b.Fw[t].filter(e=>(e.onEnv||[]).includes(g.Vi)),[t]),s=(0,k.useMemo)(()=>{let t=y.w.getState(),epochInfo=(e,n)=>t.sliceBVaultsStore.epoches["".concat(e,"_").concat(n)],myShare=e=>{let t=e.find(e=>e.bribeAmount>0n);if(!t||0n==t.bribeTotalAmount)return{myShare:"0.0%",myShareBn:0n};let n=t.bribeAmount*g.Pq/t.bribeTotalAmount;return{myShare:(0,h.Jh)(n,18),myShareBn:n}},s=n.map(e=>{let n=t.sliceUserBVaults.epoches[e.vault]||[],a=n.map(n=>{var a;return{...n,...myShare(n.bribes),epochInfo:epochInfo(e.vault,parseInt(n.epochId.toString())),settled:(null===(a=t.sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(parseInt(n.epochId.toString()))])||void 0===a?void 0:a.settled)||!1}}).filter(e=>!!e.epochInfo&&e.myShareBn>0n);return{bvc:e,epochsData:a}}).filter(e=>e.epochsData.length);return s.map(t=>{let{bvc:n,epochsData:s}=t;return[(0,a.jsx)(CoinText,{symbol:n.assetSymbol,txt:n.yTokenSymbol,size:32},"coin"),(0,a.jsx)("div",{children:s.map(e=>(0,a.jsxs)("div",{className:"flex items-baseline",children:[(0,a.jsxs)("div",{className:"w-[4rem]",children:["Epoch ",e.epochId.toString()]}),(0,a.jsxs)("div",{className:"opacity-60 text-xs",children:[(0,h.G$)(1000n*e.epochInfo.startTime)," - ",(0,h.G$)((e.epochInfo.startTime+e.epochInfo.duration)*1000n)]})]},e.epochId.toString()))},"epochs"),(0,a.jsx)("div",{children:s.map(e=>(0,a.jsx)("div",{children:(0,v.d)(e.userBalanceYToken)},e.epochId.toString()))},"amount"),(0,a.jsx)("div",{children:s.map(e=>(0,a.jsx)("div",{children:(0,v.d)(e.userBalanceYTokenSyntyetic)},e.epochId.toString()))},"time weighted"),(0,a.jsx)("div",{children:s.map(e=>(0,a.jsx)("div",{children:e.myShare},e.epochId.toString()))},"my share"),(0,a.jsx)("div",{children:s.map(t=>(0,a.jsx)("div",{children:t.settled?(0,a.jsxs)("div",{className:"flex w-fit cursor-pointer items-center gap-2 underline",onClick:()=>e.push("/b-vaults?vault=".concat(n.vault,"&tab=boost_venom")),children:["Ready to Harvest",(0,a.jsx)(L.HV3,{})]},"claim"):"Ongoing"},t.epochId.toString()))},"status")]})},[n,y.w.getState()]);return(0,a.jsx)(PortfolioItem,{title:(0,a.jsx)(IconTitle,{tit:"Boost Venom",icon:"VenomLine"}),tHeader:["","Epoch","Amount","Time Weighted Points","My Share","Status"],tData:s,tableProps:{cellClassName:(e,t)=>0==t?"flex flex-col":"leading-[30px]"}})}function StakedPoolsItem(){let e=(0,x.p)(),t=p.iK[e],n=y.w.getState().sliceLVaultsStore,s=(0,k.useMemo)(()=>{let e=t.map(e=>{var t;return(null===(t=n.user[e.vault])||void 0===t?void 0:t.buyPool_userStakingBalance)||0n}).reduce((e,t)=>e+t,0n),s=[(0,a.jsxs)("div",{className:"flex gap-6 items-center",children:[(0,a.jsx)(CoinText,{symbol:p.TW}),(0,a.jsx)("span",{children:(0,v.d)(e)})]},"usb")],l=t.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex gap-6 items-center",children:[(0,a.jsx)(CoinText,{symbol:e.assetTokenSymbol}),(0,a.jsx)("span",{children:(0,v.d)((null===(t=n.user[e.vault])||void 0===t?void 0:t.sellPool_userStakingBalance)||0n)})]},e.assetTokenSymbol)}),r=V().chunk([...s,...l],3).map(e=>3==e.length?e:V().fill(e,"",3-e.length));return r},[t,n]);return(0,a.jsx)(PortfolioItem,{title:"Staked in BuyLow/Sell High",tHeader:["","",""],tData:s})}function Dashboard(){return(0,r.a1)(),(0,r.Ev)(),(0,r.z2)(),(0,r.g2)(),(0,a.jsx)(s.E,{children:(0,a.jsxs)("div",{className:"w-full max-w-[1200px] px-4 mx-auto flex flex-col gap-5 md:pb-8",children:[(0,a.jsx)(InterestItem,{}),(0,a.jsx)(LeverageItem,{}),(0,a.jsx)(PrincipalItem,{}),(0,a.jsx)(BoostItem,{}),(0,a.jsx)(StakedPoolsItem,{})]})})}},75496:function(e,t,n){"use strict";var a=n(31113),s=n(26361);function DefEmpty(){return(0,a.jsx)("tr",{className:"text-lg font-normal text-center text-black ",children:(0,a.jsx)("td",{colSpan:100,className:"h-[100px] py-5 align-top"})})}n(64103),t.ZP=e=>{let{header:t,data:n,span:l={},empty:r=(0,a.jsx)(DefEmpty,{}),className:o="relative min-w-full bg-transparent ",headerClassName:i,headerItemClassName:u,tbodyClassName:c="",rowClassName:d,rowStyle:m,cellClassName:p,onClickRow:x,onRowMouseHover:h}=e;return(0,a.jsxs)("table",{className:(0,s.cn)("relative min-w-full bg-transparent ",o),children:[(0,a.jsx)("thead",{className:"",children:(0,a.jsx)("tr",{className:(0,s.cn)("text-left whitespace-nowrap font-normal text-black border-b border-gray-100 pt-5 pb-6 dark:text-slate-50 dark:border-zinc-600",i),children:t.map((e,t)=>(0,a.jsx)("th",{colSpan:l[t],scope:"col",className:(0,s.cn)(0==l[t]?"p-0 w-0":"p-3 font-normal text-sm",u),children:e},t))})}),(0,a.jsxs)("tbody",{className:(0,s.cn)(c),children:[n.map((e,n)=>(0,a.jsx)("tr",{onClick:()=>x&&x(n),onMouseEnter:()=>h&&h(n),onMouseLeave:()=>h&&h(-1),style:"function"==typeof m?m(n):m,className:(0,s.cn)("text-slate-700 dark:text-slate-50 font-medium whitespace-nowrap",x?"cursor-pointer hover:bg-slate-400/10":"","function"==typeof d?d(n):d),children:e.map((e,r)=>r>=t.length?(0,a.jsx)(a.Fragment,{children:e}):(0,a.jsx)("td",{colSpan:l[r],className:(0,s.cn)(0==l[r]?"p-0 w-max":"px-3 py-2 text-sm w-max","function"==typeof p?p(n,r):p),children:e},r))},n)),0===n.length&&r]})]})}},6371:function(e,t,n){"use strict";n.d(t,{C:function(){return Tip}});var a=n(31113),s=n(26361),l=n(52653),r=n(55966);function Tip(e){let{children:t,node:n,className:o,inFlex:i}=e,u=document.getElementById("tooltip-root");return t?(0,a.jsx)(l.zt,{children:(0,a.jsxs)(l.fC,{children:[(0,a.jsx)(l.xz,{asChild:!0,onClickCapture:e=>{e.preventDefault(),e.stopPropagation()},children:n?(0,a.jsx)("div",{className:(0,s.cn)("inline-block cursor-default",o),style:{verticalAlign:"text-bottom"},children:n}):(0,a.jsx)("div",{className:(0,s.cn)(i?"flex":"translate-y-[-6%] inline-block"," px-[3px] cursor-default relative",o),children:(0,a.jsx)(r.apP,{className:"inline-block stroke-slate-500"})})}),(0,a.jsx)(l.h_,{container:u,children:(0,a.jsxs)(l.VY,{className:"max-w-xs text-sm text-white bg-slate-900 shadow-lg dark:bg-[#333333] rounded-md p-4",children:[t,(0,a.jsx)(l.Eh,{})]})})]})}):n}},31889:function(e,t,n){"use strict";n.d(t,{Ev:function(){return useLoadBVaults},a1:function(){return useLoadLVaults},g2:function(){return useLoadUserBVaults},z2:function(){return useLoadUserLVaults}});var a=n(19757),s=n(64103),l=n(96670),r=n(59175),o=n(3106),i=n(64370),u=n(83978),c=n.n(u),d=n(87031),m=n(22139);function useLoadLVaults(){let e=(0,r.p)(),t=a.iK[e],{address:n}=(0,l.m)(),u=(0,s.useMemo)(()=>c().chain(a.iK[e]).map(e=>[e.assetTokenAddress,e.xTokenAddress]).flatten().concat([a.O1[e]]).union().value(),[e]);(0,i.a)({queryKey:["UpdateLvautlsTokens",u],queryFn:async()=>(await o.w.getState().sliceTokenStore.updateTokenTotalSupply(u),!0)}),(0,i.a)({queryKey:["UpdateUserLvautlsTokens",u,n],queryFn:async()=>!!n&&(await o.w.getState().sliceTokenStore.updateTokensBalance(u,n),!0)}),(0,i.a)({queryKey:["UpdateLVautls",t],queryFn:async()=>(await o.w.getState().sliceLVaultsStore.updateLVaults(t),!0)})}function useLoadBVaults(){let e=(0,r.p)(),t=(0,s.useMemo)(()=>d.Fw[e].filter(e=>(e.onEnv||[]).includes(m.Vi)),[e,m.Vi]);(0,i.a)({queryKey:[t],queryFn:async()=>(await o.w.getState().sliceBVaultsStore.updateBvaults(t),await o.w.getState().sliceBVaultsStore.updateYTokenSythetic(t),!0)});let{address:n}=(0,l.m)(),a=(0,s.useMemo)(()=>t.map(e=>[e.asset,e.pToken]).flat().reduce((e,t)=>e.includes(t)?e:[...e,t],[]),[t]);(0,i.a)({queryKey:["UpdateBvautlsTokens",a],queryFn:async()=>(await o.w.getState().sliceTokenStore.updateTokenTotalSupply(a),await o.w.getState().sliceTokenStore.updateTokenPrices(a),!0),throwOnError:(e,t)=>(console.error(e),!1)}),(0,i.a)({queryKey:["UpdateUserBvautlsTokens",a,n],queryFn:async()=>!!n&&(await o.w.getState().sliceTokenStore.updateTokensBalance(a,n),!0)})}function useLoadUserLVaults(){let{address:e}=(0,l.m)(),t=(0,r.p)(),n=a.iK[t];(0,i.a)({queryKey:["UpdateAllUserLVaults",t,e,n],queryFn:async()=>!!e&&(await Promise.all(n.map(t=>o.w.getState().sliceLVaultsStore.updateUserLVault(t,e))),!0)})}function useLoadUserBVaults(){let{address:e}=(0,l.m)(),t=(0,r.p)(),n=(0,s.useMemo)(()=>d.Fw[t].filter(e=>(e.onEnv||[]).includes(m.Vi)),[t,m.Vi]),a=(0,o.R)(e=>c().keys(e.sliceBVaultsStore.bvaults).toString());(0,i.a)({queryKey:["UpdateAllUserBvaults",n,t,e,a],queryFn:async()=>{if(!e)return!1;let t=o.w.getState().sliceBVaultsStore.bvaults;for(let e of n)if(!t[e.vault])return!1;await Promise.all(n.map(e=>o.w.getState().sliceBVaultsStore.updateEpoches(e)));let getEpochesParams=e=>{let t=o.w.getState().sliceBVaultsStore.bvaults[e.vault],n=[];for(let a=parseInt(t.epochCount.toString());a>0;a--){let t=o.w.getState().sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(a)];n.push(t)}return n};return await Promise.all(n.map(t=>o.w.getState().sliceUserBVaults.updateEpoches(t,e,getEpochesParams(t)))),!0}})}},88439:function(e,t,n){"use strict";n.d(t,{b:function(){return useMemoOfChainId}});var a=n(64103),s=n(59175);function useMemoOfChainId(e){let t=(0,s.p)(),n=(0,a.useRef)({});return(0,a.useMemo)(()=>(n.current[t]||(n.current[t]=e()),n.current[t]),[t])}},39577:function(e,t,n){"use strict";n.d(t,{$$:function(){return useSetLVaultPrices},UM:function(){return useUSBApr},aS:function(){return useValutsLeverageRatio},hC:function(){return useLVault},hY:function(){return useUserLVault},pK:function(){return d},so:function(){return useUpLVaultOnUserAction},z6:function(){return useVaultLeverageRatio}});var a=n(19757),s=n(22139),l=n(59175),r=n(88439),o=n(26361),i=n(3106),u=n(96670),c=n(73216);let d=(0,o.Yb)({vaultMode:0,discountEnable:!1},0n),m=(0,o.Yb)({},0n);function useLVault(e){return(0,i.R)(t=>t.sliceLVaultsStore.lvaults[e]||d)}function useUserLVault(e){return(0,i.R)(t=>t.sliceLVaultsStore.user[e]||m)}function useVaultLeverageRatio(e){let t=useLVault(e.vault),n=(0,o.pF)(t.aar,t.AARDecimals);return Math.max(0,1+1/(n-1))}function useValutsLeverageRatio(){let e=(0,l.p)(),t=a.iK[e],n=(0,r.b)(()=>(0,o.Yb)({},0)),s=(0,i.R)(e=>e.sliceLVaultsStore.lvaults);return t.forEach(e=>{let t=s[e.vault],a=t?(0,o.pF)(t.aar,t.AARDecimals):0;n[e.vault]=Math.max(0,1+1/(a-1))}),n}function useSetLVaultPrices(e){let t=(0,i.R)(e=>e.sliceLVaultsStore.lvaults),n=(0,i.R)(e=>e.sliceTokenStore.totalSupply),r=(0,l.p)();a.iK[r].forEach(l=>{let o=t[l.vault]||d,i=o.assetBalance,u=o.latestPrice,c=o.usbTotalSupply,m=n[l.xTokenAddress]||0n,p=m>0n&&i>0n&&u>0n&&c>0n&&i*u>c*s.Pq?(i*u-c*s.Pq)/m:0n;e[l.xTokenAddress]=p,e[l.assetTokenAddress]=u,m>0n&&i>0n&&u>0n&&c>0n&&i*u<c*s.Pq&&(e[a.O1[r]]=i*u/c)})}function useUSBApr(){let e=(0,l.p)(),t=(0,i.R)(e=>e.sliceLVaultsStore.lvaults),n=0,s=0n,r=0n;return a.iK[e].forEach(e=>{let a=t[e.vault]||d;a.isStable?(s+=a.M_USB_USDC*a.Y*a.aar/10n**a.AARDecimals,r+=a.M_USB_USDC,a.M_USB_USDC>0n&&a.Y>0n&&n++):(s+=a.M_USB_ETH*a.Y,r+=a.M_USB_ETH,a.M_USB_ETH>0n&&a.Y>0n&&n++)}),{apr:r>0n?s/r:0n,aprDecimals:10}}function useUpLVaultOnUserAction(e){let{address:t}=(0,u.m)();return()=>{(0,o.XD)(async()=>{if(!t)return;let n=i.w.getState().sliceLVaultsStore,s=[e.assetTokenAddress,e.xTokenAddress,a.O1[(0,c.BV)()]];await Promise.all([n.updateLVaults([e]),n.updateUserLVault(e,t),i.w.getState().sliceTokenStore.updateTokensBalance(s,t),i.w.getState().sliceTokenStore.updateTokenTotalSupply(s)])},3,1e3).catch(console.error)}}},36602:function(e,t,n){"use strict";n.d(t,{l:function(){return useBalances}});var a=n(26361),s=n(3106);function useBalances(){return(0,s.R)(e=>(0,a.Yb)(e.sliceTokenStore.balances,0n))}}},function(e){e.O(0,[4881,7495,7622,3113,9590,4167,8410,5116,2653,1037,5974,7112,7093,604,1744],function(){return e(e.s=14340)}),_N_E=e.O()}]);